<!DOCTYPE html>
<html>
	<head>
		<style>
			.l
			{
				text-align: left;
			}
			.c
			{
				text-align: center;
			}
		</style>
	</head>
	<body>


		<form>
			<input type="text" name="character_name" id="char_name" placeholder="character name">

			<label>Character Level
				<select name="character_level" id = "character_level" onchange="prof_bonus(); skill_bonus('prof');">
					<option value=" 1"> 1st</option>
					<option value=" 2"> 2nd</option>
					<option value=" 3"> 3rd</option>
					<option value=" 4"> 4th</option>
					<option value=" 5"> 5th</option>
					<option value=" 6"> 6th</option>
					<option value=" 7"> 7th</option>
					<option value=" 8"> 8th</option>
					<option value=" 9"> 9th</option>
					<option value="10">10th</option>
					<option value="11">11th</option>
					<option value="12">12th</option>
					<option value="13">13th</option>
					<option value="14">14th</option>
					<option value="15">15th</option>
					<option value="16">16th</option>
					<option value="17">17th</option>
					<option value="18">18th</option>
					<option value="19">19th</option>
					<option value="20">20th</option>
				</select>
			</label>

			<h2>Proficiency Bonus</h2>
			<h3 id="proficiency_bonus">2</h3>

			<div id="ability_scores">
				<h2>Ability Scores</h2>
				<table>
					<tr>
						<td id="str_mod">0</td>
						<td id="dex_mod">0</td>
						<td id="con_mod">0</td>
						<td id="int_mod">0</td>
						<td id="wis_mod">0</td>
						<td id="cha_mod">0</td>
					</tr>
					<tr>
						<td><input type="number" min=1 name="str" id="str" onchange="ability_mod(this.name, this.value); skill_bonus('str')"></td>
						<td><input type="number" min=1 name="dex" id="dex" onchange="ability_mod(this.name, this.value); skill_bonus('dex')"></td>
						<td><input type="number" min=1 name="con" id="con" onchange="ability_mod(this.name, this.value);"></td>
						<td><input type="number" min=1 name="int" id="int" onchange="ability_mod(this.name, this.value); skill_bonus('int')"></td>
						<td><input type="number" min=1 name="wis" id="wis" onchange="ability_mod(this.name, this.value); skill_bonus('wis')"></td>
						<td><input type="number" min=1 name="cha" id="cha" onchange="ability_mod(this.name, this.value); skill_bonus('cha')"></td>
					</tr>
					<tr>
						<td><label for="str">Strength</label></td>
						<td><label for="dex">Dexterity</label></td>
						<td><label for="con">Constitution</label></td>
						<td><label for="int">Intelligence</label></td>
						<td><label for="wis">Wisdom</label></td>
						<td><label for="cha">Charisma</label></td>
					</tr>
				</table>
			</div>

			<div id="skill_proficiencies">
				<table>
					<tr>
						<th class="l">Skills</th>
						<th class="l">Proficiency</th>
						<th class="l">Expertise</th>
						<th class="l">Bonus</th>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" data-skillprof="1" id="acrobatics_proficiency" onclick="skill_bonus('acrobatics'); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acrobatics"></td>
					</tr>
					
					<tr>
						<td>Animal Handling</td>
						<td class="c"><input type="checkbox" data-skillprof="1" id="animal_handling_proficiency" onclick="skill_bonus('animal_handling'); expertise(this.id, this.checked);"></td>
						<td class="c"><input type="checkbox" style="display: none" id="animal_handling_expertise"></td>
						<td class="c" id="animal_handling"></td>
					</tr>
					
					<tr>
						<td class="l">Arcana</td>
						<td class="c"><input type="checkbox" data-skillprof="1" id="arcana_proficiency" onclick="skill_bonus('arcana'); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="arcana_expertise"></td>
						<td class="c" id="arcana"></td>
					</tr>

					<tr>
						<td class="l">Athletics</td>
						<td class="c"><input type="checkbox" data-skillprof="1" checked="unchecked" id="athletics_proficiency" onclick="skill_bonus('athletics'); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="athletics_expertise"></td>
						<td class="c" id="athletics">0</td>
					</tr>
					<!--
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					<tr>
						<td class="l">Acrobatics</td>
						<td class="c"><input type="checkbox" checked="unchecked" id="acrobatics_proficiency" onclick="skill_bonus(dex,acro); expertise(this.id, this.checked)"></td>
						<td class="c"><input type="checkbox" style="display: none" id="acrobatics_expertise"></td>
						<td class="c" id="acro"></td>
					</tr>
					-->
				</table>
			</div>

		</form>
	</body>

	<script>
		let prof_bonus_dict = 
		{
			 1:2,
			 2:2,
			 3:2,
			 4:2,
			 5:3,
			 6:3,
			 7:3,
			 8:3,
			 9:4,
			10:4,
			11:4,
			12:4,
			13:5,
			14:5,
			15:5,
			16:5,
			17:6,
			18:6,
			19:6,
			20:6,
		};

		
		function setup()
		{
			//reset character name
			document.getElementById("char_name").value="";

			//set level to 1
			document.getElementById("character_level").value=" 1";

			//set checkboxes to unchecked
			let checkboxes = document.querySelectorAll('input[type="checkbox"]');
			for (i in checkboxes)
			{
				checkboxes[i].checked = false;
			}

			//set stats to 10
			//No clue why a loop won't do this, but it just won't.  So fuck it, we ball.
			document.getElementById("str").value=10;
			document.getElementById("dex").value=10;
			document.getElementById("con").value=10;
			document.getElementById("int").value=10;
			document.getElementById("wis").value=10;
			document.getElementById("cha").value=10;
			
		}

		document.addEventListener("load", setup());
		//document.removeEventListener("load", setup());
		
		/*
		let prof = document.getElementById("proficiency_bonus");
		prof.addEventListener("click", foo());
		*/

		function expertise(ID, value)
		{
			let expertise =ID.slice(0,-11) + "expertise";

			let element = document.getElementById(expertise);
			
			if (value)
			{
				element.style="display: block";
			}
			else
			{
				element.style="display: none";
			}
			
		}


		let skill_ability_dict = 
		{
			"str":["athletics"],
			"dex":["acrobatics","sleight_of_hand","stealth"],
			"int":["arcana","history","investigation","nature","religion"],
			"wis":["animal_handling","insight","medicine","perception","survival"],
			"cha":["deception","intimidation","performance","persuasion"]
		};

		function prof_bonus()
		{
			let level = Number(document.getElementById("character_level").value);
			let bonus = prof_bonus_dict[level];
			const element = document.getElementById("proficiency_bonus");
			element.innerText =String(bonus);
		}

		function ability_mod(ability, value)
		{
			const element = document.getElementById(ability+"_mod");
			let mod = Math.floor((value-10)/2);
			element.innerText = String(mod);
		}


		function skill_bonus(arg)
		{
			switch (arg)
			{
				case "str":
				case "dex":
				case "int":
				case "wis":
				case "cha":
					let skill_list = skill_ability_dict[arg];
					for (let i=0; i<skill_list.length; i++)
					{
						update_skill(skill_list[i]);
					}
					break;

				case "prof":
					let prof_list = document.querySelectorAll('input[data-skillprof="1"]');
					for(let i=0; i<prof_list.length; i++)
					{
						//console.log(prof_list[i].id);
						//console.log(prof_list[i].value);
						isProf = prof_list[i].checked;
						//console.log(isProf);
						if(isProf)
						{
							let skill_name =prof_list[i].id.slice(0,-11);
							update_skill(skill_name);
						}
						
					}
					break;


				default:
					break;
			}
		}

		function update_skill(skill_name)
		{
			let element = document.getElementById(skill_name);
			//console.log(skill_name);
			let isProficient = document.getElementById(skill_name+"_proficiency").checked;
			let isExpert = document.getElementById(skill_name+"_expertise").checked;
			//let ability_mod = fetch_ability_mod(skill_name);
			let ability_mod = Number(document.getElementById(fetch_ability_mod(skill_name)).innerHTML);
			//console.log(ability_mod);
			let prof_bonus = Number(document.getElementById("proficiency_bonus").innerHTML);
			if(isProficient && isExpert)
			{
				element.innerHTML = prof_bonus*2 + ability_mod;
			}
			else if(isProficient)
			{
				element.innerHTML = prof_bonus + ability_mod;
			}
			else
			{
				element.innerText = ability_mod;
			}
		}

		function fetch_ability_mod(skill_name)
		{
			let ability_mod = "";
			for(i in skill_ability_dict)
			{
				//console.log(i);
				for(j of skill_ability_dict[i])
				{
					//console.log(skill_ability_dict[i][0]);
					if(j === skill_name)
					{
						ability_mod=i;
					}
				}
			}
			return String(ability_mod+"_mod");
		}
	</script>

</html>